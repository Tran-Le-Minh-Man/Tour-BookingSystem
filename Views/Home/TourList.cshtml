@{
    Layout = "~/Views/Shared/_Layout.cshtml";
    ViewData["Title"] = "Tất cả tour";
    var tours = ViewData["tours"] as List<TourBookingSystem.Models.Tour>;
    var destinations = ViewData["destinations"] as List<string>;
    
    // Get filter values for restoration
    var keyword = ViewData["searchKeyword"] as string;
    var selectedDest = ViewData["selectedDestination"] as string;
    var depDate = ViewData["departureDate"] as string;
    var sortBy = ViewData["selectedSortBy"] as string;
    var minPrice = ViewData["minPrice"];
    var maxPrice = ViewData["maxPrice"];
    var duration = ViewData["duration"];
}

<div class="tourlist-banner">
    <div class="container">
        <h1>Danh sách Tour Du Lịch</h1>
        <p>Tìm thấy @(tours?.Count ?? 0) hành trình phù hợp với bạn</p>
    </div>
</div>

<div class="container main-content-grid">
    <aside class="sidebar-filters">
        <div class="filter-box">
            <h3><i class="fas fa-filter"></i> Bộ lọc tìm kiếm</h3>
            <form action="@Url.Action("TourList", "Home")" method="get">
                <div class="field-item">
                    <label>Từ khóa</label>
                    <input type="text" name="keyword" value="@keyword" placeholder="Tên tour, địa danh...">
                </div>

                <div class="field-item">
                    <label>Điểm đến</label>
                    <select name="destination">
                        <option value="">Tất cả địa điểm</option>
                        @if (destinations != null) {
                            foreach (var dest in destinations) {
                                <option value="@dest" selected="@(selectedDest == dest ? "selected" : null)">@dest</option>
                                
                            }
                        }
                    </select>
                </div>

                <div class="filter-row">
                    <div class="field-item half">
                        <label>Giá từ (VNĐ)</label>
                        <input type="number" name="minPrice" value="@minPrice" placeholder="0">
                    </div>
                    <div class="field-item half">
                        <label>Đến (VNĐ)</label>
                        <input type="number" name="maxPrice" value="@maxPrice" placeholder="50tr">
                    </div>
                </div>

                <div class="field-item">
                    <label>Thời gian</label>
                    <select name="duration">
                        <option value="">Tất cả thời gian</option>
                        <option value="1" selected="@(duration?.ToString() == "1" ? "selected" : null)">1 ngày</option> 
                        <option value="2" selected="@(duration?.ToString() == "2" ? "selected" : null)">2 ngày</option>
                        <option value="3" selected="@(duration?.ToString() == "3" ? "selected" : null)">3 ngày</option>
                        <option value="4" selected="@(duration?.ToString() == "4" ? "selected" : null)">4 ngày</option>
                        <option value="5" selected="@(duration?.ToString() == "5" ? "selected" : null)">5 ngày</option>
                        <option value="7" selected="@(duration?.ToString() == "7" ? "selected" : null)">Trên 5 ngày</option>
                    </select>
                </div>

                <div class="field-item">
                    <label>Ngày khởi hành từ</label>
                    <input type="date" name="departure_date" value="@depDate">
                </div>

                <div class="field-item">
                    <label>Sắp xếp theo</label>
                    <select name="sortBy">
                        <option value="id_desc" selected="@(sortBy == "id_desc" ? "selected" : null)">Mới nhất</option> 
                        <option value="price_asc" selected="@(sortBy == "price_asc" ? "selected" : null)">Giá tăng dần</option>
                        <option value="price_desc" selected="@(sortBy == "price_desc" ? "selected" : null)">Giá giảm dần</option>
                        <option value="date_asc" selected="@(sortBy == "date_asc" ? "selected" : null)">Ngày đi (Sắp tới)</option>
                    </select>
                </div>

                <button type="submit" class="btn-primary-solid btn-full">Áp dụng lọc</button>
                <a href="@Url.Action("TourList", "Home")" class="btn-link-reset">Đặt lại mặc định</a>
            </form>
        </div>
    </aside>

    <div class="tour-results">
        @if (tours != null && tours.Count > 0)
        {
            <div class="tour-linear-list">
                @foreach (var tour in tours)
                {
                    <div class="tour-item-row">
                        <div class="tour-item-image">
                            <img src="@tour.getSafeImageUrl()" alt="@tour.getName()" onerror="this.src='/images/nhatrang.jpg'">
                        </div>
                        <div class="tour-item-info">
                            <div class="item-header">
                                <div class="item-header-top">
                                    <span class="item-location"><i class="fas fa-map-marker-alt"></i> @tour.getDestination()</span>
                                    @{
                                        var statusText = (tour.getStatus() ?? "ACTIVE").ToUpper() == "ACTIVE" ? "Hoạt động" : "Ẩn";
                                        var statusClass = (tour.getStatus() ?? "ACTIVE").ToUpper() == "ACTIVE" ? "status-active" : "status-inactive";
                                    }
                                    <span class="item-status @statusClass">@statusText</span>
                                </div>
                                <h3>@tour.getName()</h3>
                            </div>
                            <div class="item-details">
                                <div class="detail-tag"><i class="far fa-calendar-alt"></i> KH: @(tour.getDepartureDate()?.ToString("dd/MM/yyyy") ?? "Liên hệ")</div>
                                <div class="detail-tag"><i class="far fa-clock"></i> @tour.getDuration() ngày / @(tour.getDuration()-1) đêm</div>
                                <div class="detail-tag"><i class="fas fa-users"></i> Còn @tour.getAvailableSlots() chỗ</div>
                            </div>
                            <div class="item-footer">
                                <div class="item-price">@tour.getFormattedPrice()</div>
                                <a href="@Url.Action("TourDetail", "Home", new { id = tour.getTourId() })" class="btn-details-solid">Xem chi tiết</a>
                            </div>
                        </div>
                    </div>
                }
            </div>
        }
        else
        {
            <div class="search-empty">
                <i class="fas fa-search-location"></i>
                <p>Không tìm thấy tour nào phù hợp với các tiêu chí tìm kiếm của bạn.</p>
                <a href="@Url.Action("TourList", "Home")" class="btn-primary-solid">Quay lại danh sách chính</a>
            </div>
        }
    </div>
</div>

<style>
    .tourlist-banner {
        background: #2563eb;
        color: white;
        padding: 40px 0;
        margin-bottom: 40px;
    }

    .tourlist-banner h1 { font-size: 2rem; font-weight: 700; margin-bottom: 8px; }
    .tourlist-banner p { opacity: 0.9; }

    .main-content-grid {
        display: grid;
        grid-template-columns: 300px 1fr;
        gap: 30px;
        align-items: start;
    }

    .filter-box {
        background: white;
        padding: 25px;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        border: 1px solid #e2e8f0;
    }

    .filter-box h3 {
        font-size: 1.1rem;
        margin-bottom: 20px;
        color: #1e293b;
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .field-item { margin-bottom: 15px; }
    .field-item label { display: block; font-size: 0.8rem; font-weight: 700; color: #475569; margin-bottom: 5px; }
    
    .filter-row { display: flex; gap: 10px; }
    .filter-row .half { flex: 1; }

    .field-item input, .field-item select {
        width: 100%;
        padding: 10px;
        border: 1px solid #cbd5e1;
        border-radius: 6px;
        font-size: 0.9rem;
        background: #f8fafc;
    }

    .btn-primary-solid {
        background: #2563eb;
        color: white;
        border: none;
        padding: 12px;
        border-radius: 6px;
        font-weight: 700;
        cursor: pointer;
        text-align: center;
        display: block;
        text-decoration: none;
    }

    .btn-primary-solid:hover { background: #1d4ed8; }
    .btn-full { width: 100%; margin-top: 10px; }

    .btn-link-reset {
        display: block;
        text-align: center;
        margin-top: 15px;
        color: #94a3b8;
        font-size: 0.85rem;
        text-decoration: none;
    }

    /* List Layout */
    .tour-linear-list { display: flex; flex-direction: column; gap: 20px; }

    .tour-item-row {
        background: white;
        border-radius: 8px;
        overflow: hidden;
        display: flex;
        border: 1px solid #e2e8f0;
        box-shadow: 0 1px 3px rgba(0,0,0,0.05);
    }

    .tour-item-image { width: 280px; min-width: 280px; height: 180px; }
    .tour-item-image img { width: 100%; height: 100%; object-fit: cover; }

    .tour-item-info { padding: 20px; flex-grow: 1; display: flex; flex-direction: column; justify-content: space-between; }

    .item-header-top { display: flex; justify-content: space-between; align-items: center; }
    .item-location { color: #2563eb; font-weight: 700; font-size: 0.8rem; text-transform: uppercase; }
    .item-status { font-size: 0.7rem; font-weight: 700; padding: 2px 8px; border-radius: 4px; text-transform: uppercase; }
    .status-active { background: #dcfce7; color: #166534; }
    .status-inactive { background: #fee2e2; color: #991b1b; }
    .tour-item-info h3 { font-size: 1.25rem; font-weight: 700; color: #1e293b; margin: 5px 0 12px; }

    .item-details { display: flex; gap: 15px; color: #64748b; font-size: 0.85rem; flex-wrap: wrap; }
    .item-details i { color: #2563eb; }

    .item-footer {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-top: 15px;
        padding-top: 15px;
        border-top: 1px solid #f1f5f9;
    }

    .item-price { font-size: 1.35rem; font-weight: 800; color: #dc2626; }

    .btn-details-solid {
        padding: 8px 20px;
        border: 1.5px solid #2563eb;
        color: #2563eb;
        border-radius: 6px;
        font-weight: 700;
        text-decoration: none;
        font-size: 0.85rem;
    }

    .btn-details-solid:hover { background: #2563eb; color: white; }

    .search-empty { text-align: center; padding: 60px 0; color: #94a3b8; }
    .search-empty i { font-size: 3rem; margin-bottom: 20px; opacity: 0.3; }

    @@media (max-width: 950px) {
        .main-content-grid { grid-template-columns: 1fr; }
        .tour-item-row { flex-direction: column; }
        .tour-item-image { width: 100%; height: 220px; }
    }
</style>
