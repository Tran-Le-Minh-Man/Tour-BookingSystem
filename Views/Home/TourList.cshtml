@using TourBookingSystem.Models
@{
    Layout = "~/Views/Shared/_Layout.cshtml";
    ViewData["Title"] = "Tất cả Tour Du Lịch";
    var tours = ViewData["tours"] as List<Tour>;
    var destinations = ViewData["destinations"] as List<string>;
    var selectedDestination = ViewData["selectedDestination"] as string;
    var searchKeyword = ViewData["searchKeyword"] as string;
    var departureDate = ViewData["departureDate"] as string;
    var selectedMinPrice = ViewData["minPrice"] as decimal?;
    var selectedMaxPrice = ViewData["maxPrice"] as decimal?;
    var selectedDuration = ViewData["duration"] as int?;
    var selectedSortBy = ViewData["sortBy"] as string;
}
@section Styles {
    <link rel="stylesheet" href="~/css/tour_list.css">
}
<!-- Page Header -->
<section class="page-header">
    <div class="container">
        <h1>Khám Phá Các Tour Du Lịch</h1>
        <p class="lead">Hành trình tuyệt vời chờ đợi bạn</p>
    </div>
</section>
<!-- Main Content -->
<section class="tour-list-section">
    <div class="container">
        <div class="tour-list-layout">
            <!-- Sidebar Filters -->
            <aside class="filters-sidebar">
                <div class="filter-card">
                    <h3>
                        <i class="fas fa-filter"></i> Bộ Lọc Tìm Kiếm
                    </h3>
                    <form action="@Url.Action("TourList", "Home")" method="get" class="filter-form">
                        <!-- Search by keyword -->
                        <div class="filter-group">
                            <label for="keyword">Từ khóa</label>
                            <div class="search-input-wrapper">
                                <i class="fas fa-search"></i>
                                <input type="text" id="keyword" name="keyword" placeholder="Tên tour, địa điểm..." value="@searchKeyword">
                            </div>
                        </div>
                        <!-- Destination filter -->
                        <div class="filter-group">
                            <label for="destination">Điểm đến</label>
                            <select id="destination" name="destination">
                                <option value="">Tất cả điểm đến</option>
                                @if (destinations != null)
                                {
                                    foreach (var dest in destinations)
                                    {
                                        <option value="@dest" selected="@(selectedDestination == dest)">@dest</option>
                                    }
                                }
                            </select>
                        </div>
                        <!-- Departure Date filter -->
                        <div class="filter-group">
                            <label for="departure_date">Ngày khởi hành</label>
                            <input type="date" id="departure_date" name="departure_date" value="@departureDate">
                        </div>
                        <!-- Price range filter -->
                        <div class="filter-group">
                            <label>Khoảng giá</label>
                            <div class="price-inputs">
                                <input type="number" name="minPrice" placeholder="Tối thiểu" value="@selectedMinPrice" min="0">
                                <span>-</span>
                                <input type="number" name="maxPrice" placeholder="Tối đa" value="@selectedMaxPrice" min="0">
                            </div>
                        </div>
                        <!-- Duration filter -->
                        <div class="filter-group">
                            <label for="duration">Thời gian</label>
                            <select id="duration" name="duration">
                                <option value="">Tất cả</option>
                                <option value="1" selected="@(selectedDuration == 1)">1 ngày</option>
                                <option value="2" selected="@(selectedDuration == 2)">2 ngày 1 đêm</option>
                                <option value="3" selected="@(selectedDuration == 3)">3 ngày 2 đêm</option>
                                <option value="4" selected="@(selectedDuration == 4)">4 ngày 3 đêm</option>
                                <option value="5" selected="@(selectedDuration == 5)">5 ngày 4 đêm</option>
                                <option value="7" selected="@(selectedDuration == 7)">Trên 5 ngày</option>
                            </select>
                        </div>
                        <!-- Sort by -->
                        <div class="filter-group">
                            <label for="sortBy">Sắp xếp theo</label>
                            <select id="sortBy" name="sortBy">
                                <option value="">Mặc định</option>
                                <option value="price_asc" selected="@(selectedSortBy == "price_asc")">Giá: Thấp đến cao</option>
                                <option value="price_desc" selected="@(selectedSortBy == "price_desc")">Giá: Cao đến thấp</option>
                                <option value="date_asc" selected="@(selectedSortBy == "date_asc")">Ngày khởi hành: Sớm nhất</option>
                                <option value="date_desc" selected="@(selectedSortBy == "date_desc")">Ngày khởi hành: Mới nhất</option>
                                <option value="duration_asc" selected="@(selectedSortBy == "duration_asc")">Thời gian: Ngắn nhất</option>
                                <option value="duration_desc" selected="@(selectedSortBy == "duration_desc")">Thời gian: Dài nhất</option>
                            </select>
                        </div>
                        <!-- Filter buttons -->
                        <div class="filter-buttons">
                            <button type="submit" class="btn btn-filter">
                                <i class="fas fa-search"></i> Áp dụng
                            </button>
                            <a href="@Url.Action("TourList", "Home")" class="btn btn-reset">
                                <i class="fas fa-redo"></i> Đặt lại
                            </a>
                        </div>
                    </form>
                </div>
            </aside>
            <!-- Tour Grid -->
            <main class="tours-main">
                <!-- Results header -->
                <div class="results-header">
                    <div class="results-count">
                        @if (tours == null || !tours.Any())
                        {
                            <p>
                                <i class="fas fa-info-circle"></i> Không tìm thấy tour nào phù hợp
                            </p>
                        }
                        else
                        {
                            <p>
                                <i class="fas fa-list"></i> Tìm thấy <strong>@tours.Count()</strong> tour du lịch
                            </p>
                        }
                    </div>
                    @if (!string.IsNullOrEmpty(searchKeyword))
                    {
                    }
                </div>
        </div>
    </div>
    }
</div>
    }
    else
    {
    <div class="no-results">
        <p>Không tìm thấy tour nào phù hợp</p>
        <a href="@Url.Action("TourList", "Home")" class="btn btn-primary">Xem tất cả tour</a>
    </div>
    }
</main>
</div>
</div>
@section Scripts {
        <script>
            function bookTour(tourId) {
                var quantity = prompt("Nhập số lượng người:");
                if (quantity != null && quantity > 0) {
                    fetch('@Url.Action("Index", "Booking")', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/x-www-form-urlencoded',
                        },
                        body: 'action=create&tourId=' + tourId + '&quantity=' + quantity
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.status === 'success') {
                            alert(data.message);
                            window.location.href = '@Url.Action("Index", "Booking")';
                        } else {
                            alert(data.message);
                        }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        alert('Có lỗi xảy ra!');
                    });
                }
            }
        </script>
}
