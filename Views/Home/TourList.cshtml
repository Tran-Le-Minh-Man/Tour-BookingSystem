@{
    Layout = "~/Views/Shared/_Layout.cshtml";
    ViewData["Title"] = "Danh s√°ch tour";
    var tours = ViewData["tours"] as List<TourBookingSystem.Models.Tour>;
    var destinations = ViewData["destinations"] as List<string>;
}

<div class="tour-list-page">
    <div class="page-header">
        <h1>Danh s√°ch tour du l·ªãch</h1>
    </div>
    
    <div class="content-wrapper">
        <!-- Sidebar Filter -->
        <aside class="sidebar">
            <div class="filter-section">
                <h3>T√¨m ki·∫øm</h3>
                <form action="@Url.Action("TourList", "Home")" method="get">
                    <div class="form-group">
                        <label>T·ª´ kh√≥a</label>
                        <input type="text" name="keyword" value="@ViewData["keyword"]" placeholder="T√™n tour, ƒëi·ªÉm ƒë·∫øn...">
                    </div>
                    
                    <div class="form-group">
                        <label>ƒêi·ªÉm ƒë·∫øn</label>
                        <select name="destination">
                            <option value="">T·∫•t c·∫£</option>
                            <option value="all">T·∫•t c·∫£ ƒëi·ªÉm ƒë·∫øn</option>
                            @foreach (var dest in destinations)
                            {
                                <option value="@dest" @(ViewData["destination"]?.ToString() == dest ? "selected" : "")>@dest</option>
                            }
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>Gi√° t·ª´</label>
                        <input type="number" name="minPrice" value="@ViewData["minPrice"]" placeholder="Gi√° th·∫•p nh·∫•t">
                    </div>
                    
                    <div class="form-group">
                        <label>Gi√° ƒë·∫øn</label>
                        <input type="number" name="maxPrice" value="@ViewData["maxPrice"]" placeholder="Gi√° cao nh·∫•t">
                    </div>
                    
                    <div class="form-group">
                        <label>Th·ªùi gian</label>
                        <select name="duration">
                            <option value="">T·∫•t c·∫£</option>
                            <option value="all">T·∫•t c·∫£ th·ªùi gian</option>
                            <option value="1" @(ViewData["duration"]?.ToString() == "1" ? "selected" : "")>1 ng√†y</option>
                            <option value="2" @(ViewData["duration"]?.ToString() == "2" ? "selected" : "")>2 ng√†y</option>
                            <option value="3" @(ViewData["duration"]?.ToString() == "3" ? "selected" : "")>3 ng√†y</option>
                            <option value="4" @(ViewData["duration"]?.ToString() == "4" ? "selected" : "")>4 ng√†y</option>
                            <option value="5" @(ViewData["duration"]?.ToString() == "5" ? "selected" : "")>5 ng√†y</option>
                        </select>
                    </div>
                    
                    <button type="submit" class="btn btn-primary">T√¨m ki·∫øm</button>
                    <a href="@Url.Action("TourList", "Home")" class="btn btn-secondary">X√≥a l·ªçc</a>
                </form>
            </div>
        </aside>
        
        <!-- Tour List -->
        <main class="tour-list">
            @if (tours != null && tours.Count > 0)
            {
                <div class="tour-count">T√¨m th·∫•y @tours.Count tour</div>
                <div class="tour-grid">
                    @foreach (var tour in tours)
                    {
                        <div class="tour-card">
                            <img src="@tour.getImageUrl()" alt="@tour.getName()">
                            <div class="tour-info">
                                <h3>@tour.getName()</h3>
                                <p class="destination">üìç @tour.getDestination()</p>
                                <p class="duration">‚è± @tour.getDuration() ng√†y</p>
                                <p class="departure-date">üìÖ @tour.getFormattedDepartureDate()</p>
                                <p class="price">üí∞ @tour.getFormattedPrice()</p>
                                <p class="available">C√≤n @tour.getAvailableSlots() ch·ªó</p>
                                <div class="tour-actions">
                                    <a href="@Url.Action("TourDetail", "Home", new { id = tour.getTourId() })" class="btn btn-secondary">Chi ti·∫øt</a>
                                    @if (ViewData["userId"] != null)
                                    {
                                        <button class="btn btn-primary" onclick="bookTour(@tour.getTourId())">ƒê·∫∑t ngay</button>
                                    }
                                </div>
                            </div>
                        </div>
                    }
                </div>
            }
            else
            {
                <div class="no-results">
                    <p>Kh√¥ng t√¨m th·∫•y tour n√†o ph√π h·ª£p</p>
                    <a href="@Url.Action("TourList", "Home")" class="btn btn-primary">Xem t·∫•t c·∫£ tour</a>
                </div>
            }
        </main>
    </div>
</div>

@section Scripts {
    <script>
        function bookTour(tourId) {
            var quantity = prompt("Nh·∫≠p s·ªë l∆∞·ª£ng ng∆∞·ªùi:");
            if (quantity != null && quantity > 0) {
                fetch('@Url.Action("Index", "Booking")', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: 'action=create&tourId=' + tourId + '&quantity=' + quantity
                })
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'success') {
                        alert(data.message);
                        window.location.href = '@Url.Action("Index", "Booking")';
                    } else {
                        alert(data.message);
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('C√≥ l·ªói x·∫£y ra!');
                });
            }
        }
    </script>
}
