@using TourBookingSystem.Models
@{
    Layout = "~/Views/Shared/_Layout.cshtml";
    ViewData["Title"] = "Tất cả Tour Du Lịch";
    var tours = ViewData["tours"] as List<Tour>;
    var destinations = ViewData["destinations"] as List<string>;
    var selectedDestination = ViewData["selectedDestination"] as string;
    var searchKeyword = ViewData["searchKeyword"] as string;
    var departureDate = ViewData["departureDate"] as string;
    var selectedMinPrice = ViewData["minPrice"] as decimal?;
    var selectedMaxPrice = ViewData["maxPrice"] as decimal?;
    var selectedDuration = ViewData["duration"] as int?;
    var selectedSortOf = ViewData["selectedSortBy"] as string;
}
@section Styles {
    <link rel="stylesheet" href="~/css/tour_list.css">
}
<!-- Page Header -->
<section class="page-header">
    <div class="container">
        <h1>Khám Phá Các Tour Du Lịch</h1>
        <p class="lead">Hành trình tuyệt vời chờ đợi bạn</p>
    </div>
</section>
<!-- Main Content -->
<section class="tour-list-section">
    <div class="container">
        <div class="tour-list-layout">
            <!-- Sidebar Filters -->
            <aside class="filters-sidebar">
                <div class="filter-card">
                    <h3>
                        <i class="fas fa-filter"></i> Bộ Lọc Tìm Kiếm
                    </h3>
                    <form action="@Url.Action("TourList", "Home")" method="get" class="filter-form">
                        <!-- Search by keyword -->
                        <div class="filter-group">
                            <label for="keyword">Từ khóa</label>
                            <div class="search-input-wrapper">
                                <i class="fas fa-search"></i>
                                <input type="text" id="keyword" name="keyword" placeholder="Tên tour, địa điểm..." value="@searchKeyword">
                            </div>
                        </div>
                        <!-- Destination filter -->
                        <div class="filter-group">
                            <label for="destination">Điểm đến</label>
                            <select id="destination" name="destination">
                                <option value="">Tất cả điểm đến</option>
                                @if (destinations != null)
                                {
                                    foreach (var dest in destinations)
                                    {
                                        <option value="@dest" selected="@(selectedDestination == dest)">@dest</option>
                                    }
                                }
                            </select>
                        </div>
                        <!-- Departure Date filter -->
                        <div class="filter-group">
                            <label for="departure_date">Ngày khởi hành</label>
                            <input type="date" id="departure_date" name="departure_date" value="@departureDate">
                        </div>
                        <!-- Price range filter -->
                        <div class="filter-group">
                            <label>Khoảng giá</label>
                            <div class="price-inputs">
                                <input type="number" name="minPrice" placeholder="Tối thiểu" value="@selectedMinPrice" min="0">
                                <span>-</span>
                                <input type="number" name="maxPrice" placeholder="Tối đa" value="@selectedMaxPrice" min="0">
                            </div>
                        </div>
                        <!-- Duration filter -->
                        <div class="filter-group">
                            <label for="duration">Thời gian</label>
                            <select id="duration" name="duration">
                                <option value="">Tất cả</option>
                                <option value="1" selected="@(selectedDuration == 1)">1 ngày</option>
                                <option value="2" selected="@(selectedDuration == 2)">2 ngày 1 đêm</option>
                                <option value="3" selected="@(selectedDuration == 3)">3 ngày 2 đêm</option>
                                <option value="4" selected="@(selectedDuration == 4)">4 ngày 3 đêm</option>
                                <option value="5" selected="@(selectedDuration == 5)">5 ngày 4 đêm</option>
                                <option value="7" selected="@(selectedDuration == 7)">Trên 5 ngày</option>
                            </select>
                        </div>
                        <!-- Sort by -->
                        <div class="filter-group">
                            <label for="sortBy">Sắp xếp theo</label>
                            <select id="sortBy" name="sortBy">
                                <option value="">Mặc định</option>
                                <option value="price_asc" selected="@(selectedSortOf == "price_asc")">Giá: Thấp đến cao</option>
                                <option value="price_desc" selected="@(selectedSortOf == "price_desc")">Giá: Cao đến thấp</option>
                                <option value="date_asc" selected="@(selectedSortOf == "date_asc")">Ngày khởi hành: Sớm nhất</option>
                                <option value="date_desc" selected="@(selectedSortOf == "date_desc")">Ngày khởi hành: Mới nhất</option>
                                <option value="duration_asc" selected="@(selectedSortOf == "duration_asc")">Thời gian: Ngắn nhất</option>
                                <option value="duration_desc" selected="@(selectedSortOf == "duration_desc")">Thời gian: Dài nhất</option>
                            </select>
                        </div>
                        <!-- Filter buttons -->
                        <div class="filter-buttons">
                            <button type="submit" class="btn btn-filter">
                                <i class="fas fa-search"></i> Áp dụng
                            </button>
                            <a href="@Url.Action("TourList", "Home")" class="btn btn-reset">
                                <i class="fas fa-redo"></i> Đặt lại
                            </a>
                        </div>
                    </form>
                </div>
            </aside>
            <!-- Tour Grid -->
            <main class="tours-main">
                <div class="tours-grid">
                    @if (tours != null && tours.Any())
                    {
                        foreach (var tour in tours)
                        {
                            <div class="tour-card">
                                <div class="tour-image">
                                    <img src="@(tour.getImageUrl()?.StartsWith("http") == true ? tour.getImageUrl() : Url.Content("~/" + tour.getImageUrl()))" alt="@tour.getName()" onerror="this.onerror=null;this.src='https://via.placeholder.com/400x250'">
                                </div>
                                <div class="tour-info">
                                    <div class="tour-destination">
                                        @tour.getDestination()
                                    </div>
                                    <h3 class="tour-name">
                                        <a href="@Url.Action("TourDetail", "Home", new { id = tour.getTourId() })">@tour.getName()</a>
                                    </h3>
                                    <div class="tour-meta">
                                        <div class="meta-item">
                                            <span>Khởi hành: @tour.getFormattedDepartureDate()</span>
                                        </div>
                                        <div class="meta-item">
                                            <span>@tour.getDuration() ngày</span>
                                        </div>
                                        <div class="meta-item">
                                            <span>Còn @tour.getAvailableSlots() chỗ</span>
                                        </div>
                                    </div>
                                    <div class="tour-footer">
                                        <div class="tour-price">@tour.getFormattedPrice()</div>
                                        <a href="@Url.Action("TourDetail", "Home", new { id = tour.getTourId() })" class="btn-view">Xem chi tiết</a>
                                    </div>
                                </div>
                            </div>
                        }
                    }
                    else
                    {
                        <div class="no-results">
                            <i class="fas fa-search-minus"></i>
                            <p>Không tìm thấy tour nào phù hợp với yêu cầu của bạn.</p>
                            <a href="@Url.Action("TourList", "Home")" class="btn btn-primary">Xem tất cả tour</a>
                        </div>
                    }
                </div>
            </main>
        </div>
    </div>