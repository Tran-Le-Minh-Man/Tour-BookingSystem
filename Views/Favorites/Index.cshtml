@{
    Layout = "~/Views/Shared/_Layout.cshtml";
    ViewData["Title"] = "Danh sách yêu thích";
    var favorites = ViewData["favorites"] as List<Dictionary<string, object>>;
}

<div class="fav-container">
    <div class="fav-header">
        <h1><i class="fas fa-heart text-danger"></i> Tour yêu thích</h1>
        <p>Nhiều điểm đến hấp dẫn đang chờ bạn khám phá</p>
    </div>

    @if (favorites != null && favorites.Count > 0)
    {
        <div class="tour-grid">
            @foreach (var fav in favorites)
            {
                var img = fav["tour_image"]?.ToString() ?? "";
                if (!img.StartsWith("http"))
                {
                  img = "/" + img.TrimStart('/').ToLower();
                }
                
                <div class="tour-card" id="fav-@fav["tour_id"]">
                    <div class="tour-image">
                        <img src="@img" onerror="this.src='/images/nhatrang.jpg'">
                        <button class="btn-fav active" onclick="toggleFavorite(@fav["tour_id"])">
                            <i class="fas fa-heart"></i>
                        </button>
                        
                    </div>
                    <div class="tour-content">
                        <div class="tour-destination">
                            <i class="fas fa-map-marker-alt"></i> @fav["tour_destination"]
                        </div>
                        <h3 class="tour-title">@fav["tour_name"]</h3>
                        <div class="tour-meta">
                            <span><i class="far fa-clock"></i> @fav["tour_duration"] ngày</span>
                        </div>
                        <div class="tour-footer">
                            <div class="tour-price">
                                @(string.Format("{0:N0}", fav["tour_price"])) VNĐ
                            </div>
                            <a href="@Url.Action("TourDetail", "Home", new { id = fav["tour_id"] })" class="btn-more">
                                Chi tiết <i class="fas fa-arrow-right"></i>
                            </a>
                        </div>
                    </div>
                </div>
            }
        </div>
    }
    else
    {
        <div class="no-fav">
            <i class="far fa-heart"></i>
            <h3>Bạn chưa yêu thích tour nào</h3>
            <p>Hành trình tuyệt vời vẫn còn ở phía trước!</p>
            <a href="@Url.Action("TourList", "Home")" class="btn-indigo">Khám phá ngay</a>
        </div>
    }
</div>

<style>
    .fav-container {
        max-width: 1200px;
        margin: 40px auto;
        padding: 0 20px;
    }

    .fav-header {
        text-align: center;
        margin-bottom: 50px;
    }

    .fav-header h1 {
        font-weight: 800;
        color: #1e293b;
        margin-bottom: 10px;
        font-size: 2.5rem;
    }

    .tour-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: 30px;
    }

    .tour-card {
        background: white;
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    }

    .tour-image {
        position: relative;
        height: 200px;
    }

    .tour-image img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    .btn-fav {
        position: absolute;
        top: 15px;
        right: 15px;
        background: white;
        border: none;
        width: 35px;
        height: 35px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: #cbd5e1;
        cursor: pointer;
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        transition: all 0.2s;
    }

    .btn-fav.active {
        color: #ef4444;
    }

    .tour-content {
        padding: 20px;
    }

    .tour-destination {
        color: #4361ee;
        font-weight: 700;
        font-size: 0.8rem;
        text-transform: uppercase;
        margin-bottom: 8px;
    }

    .tour-title {
        font-size: 1.1rem;
        font-weight: 700;
        color: #1e293b;
        margin-bottom: 15px;
        height: 2.8rem;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }

    .tour-meta {
        color: #64748b;
        font-size: 0.85rem;
        margin-bottom: 15px;
    }

    .tour-footer {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding-top: 15px;
        border-top: 1px solid #f1f5f9;
    }

    .tour-price {
        color: #ef4444;
        font-weight: 800;
        font-size: 1.1rem;
    }

    .btn-more {
        text-decoration: none;
        color: #4361ee;
        font-weight: 700;
        font-size: 0.9rem;
        display: flex;
        align-items: center;
        gap: 5px;
    }

    .no-fav {
        text-align: center;
        padding: 80px 0;
        color: #64748b;
    }

    .no-fav i {
        font-size: 4rem;
        color: #e2e8f0;
        margin-bottom: 20px;
    }

    .no-fav .btn-indigo {
        display: inline-block;
        margin-top: 25px;
        text-decoration: none;
    }
</style>

<script>
    function toggleFavorite(tourId) {
        fetch('@Url.Action("Toggle", "Favorites")', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded',
            },
            body: 'tourId=' + tourId
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                const card = document.getElementById('fav-' + tourId);
                card.style.opacity = '0';
                card.style.transform = 'scale(0.8)';
                setTimeout(() => {
                    card.remove();
                    if (document.querySelectorAll('.tour-card').length === 0) {
                        location.reload();
                    }
                }, 300);
            }
        });
    }
</script>
